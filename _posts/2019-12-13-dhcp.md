---
layout: post
title: DHCP protocol
tags: networking,udp,dhcp
---
### **What is DHCP**
>DHCP stands for Dynamic Host Configuration Protocol used on UDP/IP networks. DHCP enables to request IP adresses and networking parameters automatically. DHCP server provides this information to a DHCP client through the exchange of a series of messages, known as the DHCP conversation of the DHCP transaction.

### **How DHCP work**

1. The client broadcasting a DHCPDISCOVER message on its local physical subnet. The DHCPDISCOVER message may include options that suggest values for the network address and lease duration.

2. Each server may respond with a DHCPOFFER message that includes an available network address.  When allocating a new address, servers should check that the offered network address is not already in use; e.g., the server may probe the offered address with an ICMP echo request. The server transmits the DHCPOFFER message to the client.

3. The client receives one or more DHCPOFFER messages from one or more servers. The client may choose to wait for multiple responses. The client chooses one server from which to request configuration parameters, based on the configuration parameters offered int he DHCPOFFER messages. The client broadcast a DHCPREQUEST message that must include the 'server_identifier' option to indicate which server it has selected.

4. The servers receive the DHCPREQUEST broadcast from the client and if some of them not selected by the DHCPREQUEST message use the message as notification that the client has declined that server's offer. The server selected in the DHCPREQUEST message commits the binding for the client to persistent storage and responds with a DHCPACK message containing the configuration parameters for the requesting client.

5. The client receives the DHCPACK message with configuration parameters. The client should perform a final check on the parameters and notes the duration of the lease specified in the DHCPACK message. At this point, the client is configured. If the client detects that the address is already in use, the client must send a DHCPDECLINE message to the server and restarts the configuration process.

6. The client may choose to relinquish its lease on a network address by sending a DHCPRELEASE message to the server.

### **Reusing a previously allocated network address**
1. The client broadcasts a DHCPREQUEST message on its local subnet.  The message includes the client's network address in the 'requested IP address' option . If the client used a 'client identifier' to obtain its address, the client must use the same 'client identifier' in the DHCPREQUEST message.

2. Servers with knowledge of the client's configuration parameters respond with a DHCPACK message to the client. If the client's request is invalid(e.g. moved to the new subnet), server SHOULD respond with a DHCPNAK message to the client.

3. The client receives the DHCPACK message with configuration parameters. The client performs a final check on the parameters, and notes the duration of the lease specified in the DHCPACK message.

4. The client may choose to relinquish its lease on a network address by sending a DHCPRELEASE message to the server.

### **List of DHCP messages**

| Message | Use |
|---------|---|
|DHCPDISCOVER| client broadcast to locate available servers|
|DHCPOFFER | server to client in response to DHCPDISCOVER with offer of configuration parameters |
|DHCPREQUEST | client message to servers either requesting offered parameters from one server and implicitly declining offers from all others or confirming correctness of previously allocated address after |
|DHCPACK | server to client with configuration parameters, including commited network address |
|DHCPNAK | server to client indicating client's notion of network address is incorrect (moved to new subnet) or client's lease as expired |
|DHCPDECLINE | client to server indicating network address is already in user |
|DHCPRELEASE | client to server relinguishing network address and cancelling remaining |
|DHCPINFORM | client to server, asking only for local configuration parameters |

For more info visit [RFC2131](https://tools.ietf.org/html/rfc2131)
